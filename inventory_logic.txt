Raiders of the Lost Ark (Atari 2600) - Inventory System Analysis

1. Overview
   The game uses a unique two-controller scheme.
   - Right Controller (Player 1): Moves Indy. Button "Uses" selected item.
   - Left Controller (Player 0): Manages Inventory. Joystick Left/Right selects item. Button Drops item.

2. Data Structures
   - inventoryGfxPtrs (RAM $CA-$D5):
     An array of 6 slots (2 bytes each, though index increments by 2, only LSB is stored in array?).
     Wait, the code `sta inventoryGfxPtrs,x` with X=0,2,4... suggests 1 byte utilized per 2-byte stride?
     Or maybe the array is just bytes at $CA, $CC, etc?
     The LSB of the Sprite Pointer is stored here. The High Byte is always $>InventorySprites.
   - inventoryItemCount (RAM): Tracks number of items (Max 6).
   - selectedInventorySlot (RAM): Index (0, 2, 4...) of the currently highlighted slot.
   - selectedInventoryId (RAM): The Logical ID (0-18) of the selected item. Derived from the Sprite Pointer.

3. Adding Items (`PlaceItemInInventory` - Line 2670)
   - Checks `inventoryItemCount` < 6.
   - Scans `inventoryGfxPtrs` for an empty slot (Value 0 / EmptySprite LSB).
   - Stores the new Item's Sprite LSB in the slot.
   - Increments `inventoryItemCount`.
   - Automatically selects the new item (`selectedInventorySlot` = new index).
   - Sets `selectedInventoryId`.
   - Updates "Taken" status bits (e.g. `basketItemsStatus`).

4. Selecting Items (`HandleInventorySelection` - Line 3680)
   - Triggered by Left Controller Joystick (SWCHA Bits 4-7).
   - Bit 7 (Right) -> Increments `selectedInventorySlot` (wraps 0-10).
   - Bit 6 (Left) -> Decrements `selectedInventorySlot` (wraps 0-10).
   - Skips empty slots (loops until `inventoryGfxPtrs[x]` != 0).
   - Updates `selectedInventorySlot` and recasting `selectedInventoryId`.

5. Dropping Items (`HandleInventoryButtonPress` -> `TakeItemFromInventory`)
   - Triggered by Left Controller Button (INPT4).
   - Calls `TakeItemFromInventory` with Carry Set.
   - Sets the current slot to `ID_INVENTORY_EMPTY` (Zero out pointer).
   - Decrements `inventoryItemCount`.
   - Clears "Taken" status for the item (if applicable).
   - Executes specific "Drop Effect" via `RemoveItemFromInventoryJumpTable`.

6. Drop Effects (Jump Table)
   - The table maps Item IDs to handlers.
   - COINS (ID 4): If dropped in Black Market (Room 2) on left side, modifies `blackMarketState` (Buying logic).
   - PARACHUTE (ID 3): Clears Parachute Active flag.
   - WHIP (ID 10) / SHOVEL (ID 11): Specific cleanup.
   - CHAI (ID 17): Checks for "Yar's Revenge" Warp (Screen shake/Flying).
   - ANKH (ID 16) / HOURGLASS (ID 18): Checks if dropped in Mesa Field for end-game logic.
   - OTHERS: Standard removal.

7. Item IDs (Derived from Sprite Position)
   0: Empty               10: Whip
   1: Copyright_3         11: Shovel
   2: Flute               12: Copyright_0
   3: Parachute           13: Revolver
   4: Coins               14: Head of Ra
   5: Market Grenade      15: Time Piece
   6: Black Mkt Grenade   16: Ankh
   7: Key                 17: Chai
   8: Ark                 18: Hour Glass
   9: Copyright_1
